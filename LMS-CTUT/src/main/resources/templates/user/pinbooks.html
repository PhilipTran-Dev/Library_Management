<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <title>Thư viện Trường ĐH Kỹ Thuật - Công Nghệ Cần Thơ - CTUT</title>

    <link rel="icon" type="image/png" sizes="64x64" th:href="@{/images/user/logo_tab.PNG}">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"/>

    <!-- CSS -->
    <link rel="stylesheet" th:href="@{/css/user/layout.css}">
    <link rel="stylesheet" th:href="@{/css/user/header.css}">
    <link rel="stylesheet" th:href="@{/css/user/footer.css}">
    <link rel="stylesheet" th:href="@{/css/user/home.css}">
</head>

<body>

<!-- Header -->
<div th:replace="~{components/user/header :: header}"></div>

<!-- Banner -->
<section class="hero-banner position-relative">
    <img th:src="@{/images/user/banner.png}" class="w-100" alt="Banner"/>

    <div class="search-container">
        <form th:action="@{/user/search}" method="get" class="search-form">
            <input type="text" name="keyword" placeholder="Nhập từ khóa..." required>
            <button type="submit" class="btn-search">
                <i class="bi bi-search"></i>
            </button>
        </form>
    </div>
</section>

<div class="container my-4">
    <h3 class="fw-bold text-center mb-4">Sách đã ghim</h3>

    <!-- Không có sách -->
    <div th:if="${pinBooksList.size() == 0}" class="text-center text-muted">
        Bạn chưa ghim cuốn sách nào.
    </div>

    <!-- Danh sách sách ghim -->
    <div th:each="pin, stat : ${pinBooksList}"
         class="search-result-card p-3 mb-3 d-flex align-items-start shadow-sm border rounded">

        <!-- STT -->
        <div class="me-3 text-muted fw-bold" th:text="${stat.index + 1}"></div>

        <!-- Ảnh -->
        <div class="me-3">
            <a th:href="@{/user/books/{id}(id=${pin.books.id})}">
                <img th:src="${pin.books.image != null && pin.books.image != ''
                             ? pin.books.image
                             : '/images/user/no-cover.png'}"
                     class="rounded"
                     style="width:80px;height:auto;">
            </a>
        </div>

        <!-- Nội dung -->
        <div class="flex-grow-1">
            <div class="text-uppercase small text-secondary fw-bold mb-1">BOOK</div>

            <h5 class="fw-semibold mb-1">
                <a th:href="@{/user/books/{id}(id=${pin.books.id})}"
                   th:text="${pin.books.bookName}"
                   class="text-decoration-none text-dark"></a>
            </h5>


            <p class="mb-1 text-muted">
                <span th:text="${pin.author}"></span><br>
                <span th:text="${pin.books.category.name}"></span><br>
                <span th:text="${pin.books.isbn}"></span>
            </p>

            <div class="text-success fw-semibold small">
                <i class="bi bi-link-45deg"></i> Available
            </div>

            <div class="mt-2">
                <a th:href="'https://books.google.com.vn/books?id=' + ${pin.books.bookCode}"
                   target="_blank"
                   class="btn btn-sm btn-outline-primary">
                    Xem Google Books
                </a>
            </div>
        </div>

        <!-- Action -->
        <div class="ms-3 text-end d-flex flex-column align-items-end">
            <form th:action="@{'/user/deletePin/' + ${pin.books.id}}" method="post">
                <button type="submit" class="btn btn-link text-primary p-1">
                    <i class="bi bi-pin-angle-fill"></i>
                </button>
            </form>

            <button class="btn btn-link text-dark p-1"><i class="bi bi-chat-quote"></i></button>
            <button class="btn btn-link text-dark p-1"><i class="bi bi-envelope"></i></button>
            <button class="btn btn-link text-dark p-1"><i class="bi bi-three-dots"></i></button>
        </div>
    </div>
</div>

<!-- JS giữ vị trí scroll -->
<script>
    document.addEventListener("DOMContentLoaded", () => {
        if (sessionStorage.scrollPosition) {
            window.scrollTo(0, sessionStorage.scrollPosition);
            sessionStorage.removeItem("scrollPosition");
        }

        document.querySelectorAll("form").forEach(form => {
            form.addEventListener("submit", () => {
                sessionStorage.scrollPosition = window.scrollY;
            });
        });
    });
</script>

</body>
</html>
