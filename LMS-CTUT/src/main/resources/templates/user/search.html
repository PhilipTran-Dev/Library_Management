<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8" />
    <title>Th∆∞ vi·ªán Tr∆∞·ªùng ƒêH K·ªπ Thu·∫≠t - C√¥ng Ngh·ªá C·∫ßn Th∆° - CTUT</title>
    <link rel="icon" type="image/png" sizes="64x64" th:href="@{/images/user/logo_tab.PNG}">
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />

    <!-- CSS (kh·ªëi USER) -->
    <link rel="stylesheet" th:href="@{/css/user/layout.css}">
    <link rel="stylesheet" th:href="@{/css/user/header.css}">
    <link rel="stylesheet" th:href="@{/css/user/footer.css}">
    <link rel="stylesheet" th:href="@{/css/user/home.css}">
</head>
<style>
    .book-panel {
        position: fixed;
        top: 0;
        right: -100%;
        /* ban ƒë·∫ßu ·∫©n ho√†n to√†n */
        width: 100%;
        max-width: 900px;
        /* b·∫°n c√≥ th·ªÉ ƒëi·ªÅu ch·ªânh */
        height: 100%;
        background-color: #fff;
        box-shadow: -2px 0 10px rgba(0, 0, 0, 0.3);
        transition: right 0.5s ease;
        z-index: 2000;
        display: flex;
        flex-direction: column;
    }

    .book-panel.show {
        right: 0;
        /* tr∆∞·ª£t v√†o khi m·ªü */
    }

    .book-panel-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid #ddd;
        padding: 12px 16px;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .close-btn {
        font-size: 28px;
        background: none;
        border: none;
        color: #333;
        cursor: pointer;
        line-height: 1;
    }

    .close-btn:hover {
        color: red;
    }

    .pin-btn i {
        font-size: 1.4rem;
        color: #6c757d;
        transition: all 0.35s ease;
    }

    .pin-btn i.pinned {
        color: #ffc107;
        transform: rotate(-20deg) scale(1.2);
        animation: bounce 0.4s ease;
    }

    @keyframes bounce {
        0% {
            transform: scale(1);
        }

        30% {
            transform: scale(1.3) rotate(-15deg);
        }

        60% {
            transform: scale(0.9) rotate(10deg);
        }

        100% {
            transform: scale(1) rotate(0);
        }
    }

    .pin-toast {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #212529;
        color: #fff;
        padding: 10px 16px;
        border-radius: 10px;
        font-size: 0.9rem;
        opacity: 0;
        pointer-events: none;
        transform: translateY(-10px);
        transition: opacity 0.3s, transform 0.3s;
        z-index: 9999;
    }

    .pin-toast.show {
        opacity: 1;
        transform: translateY(0);
    }
</style>

<body>
    <!-- Header (fragment) -->
    <div th:replace="~{components/user/header :: header}"></div>

    <!-- Hero Banner -->
    <section class="hero-banner position-relative">
        <img th:src="@{/images/user/banner.png}" alt="Th∆∞ vi·ªán" class="w-100" />

        <div class="search-container">
            <form th:action="@{/user/search}" method="get" class="search-form">
                <input type="text" name="keyword" placeholder="Nh·∫≠p t·ª´ kh√≥a..." required>
                <button type="submit" class="btn-search" aria-label="T√¨m ki·∫øm">
                    <i class="bi bi-search"></i>
                </button>
            </form>
        </div>
    </section>


    <div class="container my-4">
        <div th:if="${bookPageContent.size() == 0}" class="text-center text-muted">
            Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ n√†o cho "<span th:text="${keyword}"></span>"
        </div>

        <div th:each="book, stat : ${bookPageContent}"
            class="search-result-card p-3 mb-3 d-flex align-items-start border rounded shadow-sm">

            <!-- S·ªë th·ª© t·ª± -->
            <div class="me-3 text-muted fw-bold" th:text="${stat.index + 1}"></div>

            <!-- ·∫¢nh b√¨a -->
            <div class="me-3">
                <a th:href="@{/user/books/{id}(id=${book.id})}" class="text-decoration-none text-dark">
                    <img th:if="${book.image != null && book.image != ''}" th:src="${book.image}" alt="Book cover"
                        class="rounded" style="width: 80px; height: auto; cursor:pointer;">
                    <img th:if="${book.image == null || book.image == ''}" th:src="@{/images/user/no-cover.png}"
                        alt="No cover" class="rounded" style="width: 80px; height: auto; cursor:pointer;">
                </a>
            </div>

            <!-- N·ªôi dung ch√≠nh -->
            <div class="flex-grow-1 d-flex justify-content-between align-items-start">

                <!-- Th√¥ng tin s√°ch -->
                <div>
                    <div class="text-uppercase small text-secondary fw-bold mb-1">BOOK</div>

                    <h5 class="fw-semibold mb-1">
                        <a th:href="@{/user/books/{id}(id=${book.id})}" class="text-decoration-none text-dark"
                            th:text="${book.bookName}">
                        </a>
                    </h5>

                    <div class="small text-muted">
                        <span>T√°c gi·∫£: </span><span th:if="${book.authors != null && !#lists.isEmpty(book.authors)}"
                            th:text="${#strings.listJoin(book.authors.![name], ', ')}">
                        </span>
                        <span th:if="${book.authors == null || #lists.isEmpty(book.authors)}">
                            Kh√¥ng r√µ
                        </span>

                        <span>T√¨nh tr·∫°ng: </span><span th:text="${book.status}">Kh√¥ng r√µ</span>
                    </div>
                </div>
                <!-- Icon h√†nh ƒë·ªông -->
                <div class="ms-3 text-end d-flex flex-column align-items-end">
                    <iframe name="hiddenFrame" style="display:none;"></iframe>

                    <!-- N√∫t Ghim s√°ch -->
                    <form th:action="@{/user/addPin/{id}(id=${book.id})}" method="post" target="hiddenFrame"
                        onsubmit="togglePinEffect(event)" class="mb-1">
                        <button type="submit" class="btn btn-link text-dark p-1" title="Ghim s√°ch">
                            <i class="bi bi-pin"></i>
                        </button>
                    </form>

                    <!-- C√°c n√∫t kh√°c -->
                    <button class="btn btn-link text-dark p-1" title="B√¨nh lu·∫≠n"><i
                            class="bi bi-chat-quote"></i></button>
                    <button class="btn btn-link text-dark p-1" title="G·ª≠i th∆∞"><i class="bi bi-envelope"></i></button>
                    <button class="btn btn-link text-dark p-1" title="T√πy ch·ªçn kh√°c"><i
                            class="bi bi-three-dots"></i></button>
                </div>



            </div>
        </div>
        <script>
            function openBookIframe(element) {
                event.preventDefault();
                const code = element.getAttribute('data-code');
                const title = element.textContent;

                const iframe = document.getElementById('bookPanelFrame');
                const panel = document.getElementById('bookPanel');
                const panelTitle = document.getElementById('bookPanelTitle');

                panelTitle.textContent = title;
                iframe.src = `https://books.google.com.vn/books?id=${code}&hl=vi&pg=PP1&output=embed`;

                panel.classList.add('show');
            }

            function closeBookPanel() {
                const panel = document.getElementById('bookPanel');
                const iframe = document.getElementById('bookPanelFrame');

                panel.classList.remove('show');
                iframe.src = ""; // ng·∫Øt t·∫£i s√°ch khi ƒë√≥ng l·∫°i
            }
        </script>
        <script>
            function togglePinEffect(event) {
                event.preventDefault(); // Kh√¥ng reload trang

                const form = event.currentTarget;
                const icon = form.querySelector("i");

                // G·ª≠i request qua hiddenFrame
                form.submit();

                // Hi·ªáu ·ª©ng ƒë·ªïi icon v√† m√†u
                icon.classList.remove("bi-pin");
                icon.classList.add("bi-pin-fill", "text-primary");
                icon.style.transition = "transform 0.3s";
                icon.style.transform = "rotate(-30deg)";

                // Th√¥ng b√°o toast nh·ªè
                showPinToast("üìå Ghim s√°ch th√†nh c√¥ng!");
            }

            function showPinToast(message) {
                let toast = document.getElementById("pinToast");
                if (!toast) {
                    toast = document.createElement("div");
                    toast.id = "pinToast";
                    toast.className = "pin-toast";
                    document.body.appendChild(toast);
                }
                toast.textContent = message;
                toast.style.display = "block";
                setTimeout(() => toast.style.display = "none", 2500);
            }
        </script>

</body>

</html>