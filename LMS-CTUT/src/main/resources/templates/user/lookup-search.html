<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <title>Trang tìm kiếm tài liệu — Thư viện CTUT</title>
    <link rel="icon" type="image/png" sizes="64x64" th:href="@{/images/user/logo_tab.PNG}">
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />

    <!-- CSS khối USER -->
    <link rel="stylesheet" th:href="@{/css/user/layout.css}">
    <link rel="stylesheet" th:href="@{/css/user/header.css}">
    <link rel="stylesheet" th:href="@{/css/user/footer.css}">
    <link rel="stylesheet" th:href="@{/css/user/lookup.css}">
</head>

<body>
<!-- Header (fragment) -->
<div th:replace="~{components/user/header :: header}"></div>

<main class="container py-4 lookup-page">

    <!-- ====== THANH TÌM KIẾM CHÍNH (NGANG VỚI LOGO, NGAY DƯỚI HEADER) ====== -->
    <section class="search-hero mb-4">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="search-title mb-2">Tra cứu tài liệu</h1>
                <p class="search-subtitle mb-3">
                    Nhập từ khóa, chọn loại tài liệu và nhấn tìm kiếm để xem kết quả.
                </p>

                <form class="search-form d-flex gap-2 flex-wrap"
                      th:action="@{/user/search}" method="get">
                    <!-- Ô từ khóa -->
                    <div class="flex-grow-1 search-input-group">
                        <span class="search-icon"><i class="bi bi-search"></i></span>
                        <input type="text" class="form-control search-input"
                               name="keyword"
                               placeholder="Nhập tên sách, tác giả, chủ đề..."
                               th:value="${keyword}">
                    </div>

                    <!-- Loại tài liệu (optional) -->
                    <select class="form-select search-type-select" name="status">
                        <option value="" th:selected="${status == null or status == ''}">
                            Tất cả loại tài liệu
                        </option>
                        <option value="BOOK" th:selected="${status == 'BOOK'}">Sách / Giáo trình</option>
                        <option value="THESIS" th:selected="${status == 'THESIS'}">Luận văn / Luận án</option>
                        <option value="MAGAZINE" th:selected="${status == 'MAGAZINE'}">Báo / Tạp chí</option>
                        <option value="EBOOK" th:selected="${status == 'EBOOK'}">Tài liệu số</option>
                    </select>

                    <!-- Nút tìm -->
                    <button type="submit" class="btn btn-primary search-btn">
                        <i class="bi bi-search me-1"></i> Tìm kiếm
                    </button>
                </form>
            </div>

            <div class="col-lg-4 d-none d-lg-block text-end">
                <!-- Có thể thay bằng hình minh họa nếu muốn -->
                <div class="search-hero-illustration">
                    <i class="bi bi-book-half"></i>
                </div>
            </div>
        </div>
    </section>

    <!-- ====== KHU VỰC BỘ LỌC + KẾT QUẢ ====== -->
    <section class="search-content">
        <div class="row">
            <!-- BỘ LỌC BÊN TRÁI -->
            <aside class="col-lg-3 mb-4">
                <div class="filter-card">
                    <h5 class="filter-title">
                        <i class="bi bi-funnel me-2"></i>Bộ lọc tìm kiếm
                    </h5>

                    <!-- Form bộ lọc (cùng submit với thanh tìm kiếm nếu muốn) -->
                    <form th:action="@{/user/search}" method="get">
                        <input type="hidden" name="keyword" th:value="${keyword}"/>

                        <!-- Loại tài liệu -->
                        <div class="filter-group">
                            <div class="filter-group-header">Loại tài liệu</div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="status" value=""
                                       id="typeAll" th:checked="${status == null or status == ''}">
                                <label class="form-check-label" for="typeAll">Tất cả</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="status" value="BOOK"
                                       id="typeBook" th:checked="${status == 'BOOK'}">
                                <label class="form-check-label" for="typeBook">Sách / Giáo trình</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="status" value="THESIS"
                                       id="typeThesis" th:checked="${status == 'THESIS'}">
                                <label class="form-check-label" for="typeThesis">Luận văn / Luận án</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="status" value="MAGAZINE"
                                       id="typeMagazine" th:checked="${status == 'MAGAZINE'}">
                                <label class="form-check-label" for="typeMagazine">Báo / Tạp chí</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="status" value="EBOOK"
                                       id="typeEbook" th:checked="${status == 'EBOOK'}">
                                <label class="form-check-label" for="typeEbook">Tài liệu số</label>
                            </div>
                        </div>

                        <!-- Năm xuất bản (demo tĩnh) -->
                        <div class="filter-group">
                            <div class="filter-group-header">Khoảng năm xuất bản</div>
                            <div class="row g-2">
                                <div class="col-6">
                                    <input type="number" class="form-control" name="yearFrom"
                                           placeholder="Từ năm">
                                </div>
                                <div class="col-6">
                                    <input type="number" class="form-control" name="yearTo"
                                           placeholder="Đến năm">
                                </div>
                            </div>
                        </div>

                        <!-- Tình trạng (chỉ hiển thị, chưa cần xử lý backend cũng được) -->
                        <div class="filter-group">
                            <div class="filter-group-header">Tình trạng</div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="AVAILABLE" id="available">
                                <label class="form-check-label" for="available">
                                    Còn trên kệ
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="BORROWED" id="borrowed">
                                <label class="form-check-label" for="borrowed">
                                    Đang được mượn
                                </label>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary w-100 mt-2">
                            Áp dụng bộ lọc
                        </button>
                    </form>
                </div>
            </aside>

            <!-- KẾT QUẢ BÊN PHẢI -->
            <div class="col-lg-9">
                <div class="results-header d-flex justify-content-between align-items-center mb-3">
                    <div>
                        <h5 class="mb-1">Kết quả tìm kiếm</h5>
                        <p class="mb-0 text-muted">
                            Từ khóa:
                            <strong th:text="${keyword != null && keyword != '' ? keyword : '—'}">—</strong>
                        </p>
                    </div>
                    <div class="results-count text-muted">
                        <span th:text="${totalItems}">0</span> tài liệu
                    </div>
                </div>

                <!-- Nếu không có kết quả -->
                <div class="no-results alert alert-light border" th:if="${#lists.isEmpty(bookPageContent)}">
                    <i class="bi bi-info-circle me-2"></i>
                    Không tìm thấy tài liệu phù hợp. Vui lòng thử lại với từ khóa hoặc bộ lọc khác.
                </div>

                <!-- Danh sách kết quả -->
                <div class="results-list" th:if="${!#lists.isEmpty(bookPageContent)}">
                    <div class="result-item"
                         th:each="book : ${bookPageContent}">
                        <div class="result-main">
                            <h6 class="result-title mb-1" th:text="${book.title}">Tên tài liệu</h6>
                            <div class="result-meta text-muted mb-1">
                                <span th:text="${book.author}">Tác giả</span>
                                <span class="mx-2">•</span>
                                <span>Năm: <span th:text="${book.year}">2023</span></span>
                                <span class="mx-2">•</span>
                                <span>Môn học: <span th:text="${book.subject}">Môn học</span></span>
                            </div>
                            <p class="result-description mb-1"
                               th:text="${#strings.abbreviate(book.description, 150)}">
                                Mô tả ngắn về tài liệu...
                            </p>
                        </div>

                        <div class="result-side text-end">
                            <span class="badge status-badge"
                                  th:text="${book.status}">
                                Còn trên kệ
                            </span>
                            <a class="btn btn-outline-primary btn-sm mt-2"
                               th:href="@{|/user/books/${book.id}|}">
                                Xem chi tiết
                            </a>
                        </div>
                    </div>
                </div>

                <!-- PHÂN TRANG (nếu bạn đã truyền currentPage & totalPages) -->
                <nav class="mt-3" th:if="${totalPages > 1}">
                    <ul class="pagination justify-content-center">
                        <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                            <a class="page-link"
                               th:href="@{/user/search(page=${currentPage - 1}, keyword=${keyword}, status=${status})}">
                                Trước
                            </a>
                        </li>

                        <li class="page-item"
                            th:each="i : ${#numbers.sequence(0, totalPages-1)}"
                            th:classappend="${i == currentPage} ? 'active'">
                            <a class="page-link"
                               th:text="${i + 1}"
                               th:href="@{/user/search(page=${i}, keyword=${keyword}, status=${status})}">
                            </a>
                        </li>

                        <li class="page-item" th:classappend="${currentPage + 1 == totalPages} ? 'disabled'">
                            <a class="page-link"
                               th:href="@{/user/search(page=${currentPage + 1}, keyword=${keyword}, status=${status})}">
                                Sau
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </section>
</main>

<!-- Footer (fragment) -->
<div th:replace="~{components/user/footer :: userFooter}"></div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/user/layout.js}"></script>
<script th:src="@{/js/user/active-menu.js}"></script>
</body>
</html>
